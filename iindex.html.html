<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Interactiva ICO - Plan 9</title>
    <style>
        /* --- CONFIGURACI√ìN DE COLORES BASE (Se actualizan con JS) --- */
        :root {
            --color-fondo: #fbf8fd;       
            --color-principal: #4a148c;   
            --color-secundario: #7b1fa2;  
            --color-texto: #212121;       
            
            --estado-aprobado-bg: #e1bee7;    
            --estado-aprobado-borde: #6a1b9a; 
            --estado-bloqueado-bg: #f5f5f5;   
            --estado-disponible-borde: #d500f9; 
        }

        body { 
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            background-color: var(--color-fondo); 
            margin: 0; padding: 20px; color: var(--color-texto); 
            transition: background-color 0.5s;
        }

        /* BARRA SUPERIOR (Botones de control) */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn-control {
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #ccc;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            color: #555;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-control:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn-reset { color: #d32f2f; border-color: #ef9a9a; }
        .btn-reset:hover { background-color: #ffebee; }

        /* Encabezado */
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--color-principal); margin: 0; font-size: 2.0em; text-transform: uppercase; letter-spacing: 1px; transition: color 0.5s; }
        p.subtitle { color: #666; font-style: italic; margin-top: 5px; margin-bottom: 15px; }
        
        /* MENU DESPLEGABLE DE MENCI√ìN */
        .selector-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        select#selector-mencion {
            padding: 12px 20px;
            font-size: 1.1em;
            color: white;
            background-color: var(--color-principal);
            border: 2px solid var(--color-secundario);
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            outline: none;
            transition: background 0.3s, border-color 0.3s;
        }

        select#selector-mencion:hover {
            filter: brightness(1.1);
        }

        /* TABLERO DE CONTROL */
        .dashboard { 
            background: white; padding: 25px; border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); 
            max-width: 900px; margin: 0 auto 40px auto; 
            border-top: 5px solid var(--color-principal);
            position: sticky; top: 10px; z-index: 100;
            transition: border-color 0.5s;
        }

        .stats-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: var(--color-principal); transition: color 0.5s; }
        
        .progress-container { background-color: #eceff1; border-radius: 15px; height: 25px; overflow: hidden; }
        .progress-bar { 
            background: linear-gradient(90deg, var(--color-secundario), var(--color-principal)); 
            height: 100%; width: 0%; transition: width 0.6s ease, background 0.5s;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 0.85em; font-weight: bold;
        }

        /* LA MALLA */
        .malla-scroll { 
            display: flex; overflow-x: auto; padding-bottom: 30px; gap: 15px; 
            scrollbar-width: thin; scrollbar-color: var(--color-principal) #eceff1;
        }
        
        .semestre-col { 
            min-width: 200px; max-width: 200px; flex-shrink: 0; 
            background: transparent; display: flex; flex-direction: column; gap: 12px;
        }

        .semestre-header { 
            background-color: var(--color-principal); color: white; 
            padding: 10px; text-align: center; border-radius: 6px; 
            font-weight: bold; font-size: 0.95em; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.5s;
        }

        /* TARJETAS DE RAMOS */
        .card-ramo { 
            background: white; padding: 12px; border-radius: 6px; 
            border-left: 5px solid #ccc; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative; min-height: 110px; 
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .card-ramo:hover { transform: translateY(-3px); box-shadow: 0 5px 12px rgba(0,0,0,0.15); }

        .codigo { font-size: 0.65em; color: #b0bec5; text-transform: uppercase; margin-bottom: 4px; text-align: right; }
        .nombre { font-size: 0.85em; font-weight: 700; line-height: 1.3; color: #333; margin-bottom: 4px;}
        
        .req-text {
            font-size: 0.7em;
            color: rgba(0, 0, 0, 0.35); 
            margin-bottom: auto; 
            line-height: 1.2;
            font-style: italic;
        }

        .creditos { font-size: 0.75em; align-self: flex-end; background: #f3e5f5; padding: 2px 6px; border-radius: 4px; color: #555; margin-top: 8px;}

        /* ESTADOS */
        .card-ramo.aprobado { 
            background-color: var(--estado-aprobado-bg); 
            border-left-color: var(--estado-aprobado-borde); 
        }
        .card-ramo.aprobado .nombre { color: var(--color-principal); }
        .card-ramo.aprobado::after { content: '‚úì'; position: absolute; top: 10px; right: 10px; color: var(--estado-aprobado-borde); font-weight: bold; font-size: 1.2em; }

        .card-ramo.disponible { 
            border-left-color: var(--estado-disponible-borde); 
            background-color: white; 
        }

        .card-ramo.bloqueado { 
            background-color: var(--estado-bloqueado-bg); 
            border-left-color: #b0bec5; opacity: 0.7; cursor: not-allowed;
        }
        .card-ramo.bloqueado .nombre { color: #9e9e9e; }

    </style>
</head>
<body>

    <div class="top-bar">
        <button class="btn-control btn-reset" onclick="resetearProgreso()">Reiniciar Malla</button>
        
        <select class="btn-control" id="selector-tema" onchange="cambiarTema(this.value)">
            <option value="morado">Tema: Morado</option>
            <option value="rosado">Tema: Rosado</option>
            <option value="azul">Tema: Azul</option>
            <option value="verde">Tema: Verde</option>
        </select>
    </div>

    <header>
        <h1>Malla Interactiva ICO</h1>
        <p class="subtitle">Plan 9 ‚Ä¢ Universidad Diego Portales</p>
        
        <div class="selector-container">
            <select id="selector-mencion" onchange="cambiarMencion()">
                <option value="economia">Menci√≥n Econom√≠a</option>
                <option value="administracion">Menci√≥n Administraci√≥n</option>
                <option value="emprendimiento">Menci√≥n Emprendimiento</option>
            </select>
        </div>
    </header>

    <div class="dashboard">
        <div class="stats-row">
            <span>Avance Global</span>
            <span id="texto-progreso">0%</span>
        </div>
        <div class="progress-container">
            <div id="barra-progreso" class="progress-bar">0%</div>
        </div>
        <div style="margin-top: 10px; display: flex; justify-content: space-between; font-size: 0.9em; color: #666;">
            <span>Cr√©ditos: <b id="texto-creditos">0</b> / <span id="total-creditos-malla"></span></span>
            <span>Ramos Aprobados: <b id="conteo-ramos">0</b></span>
        </div>
    </div>

    <div class="malla-scroll" id="contenedor-malla">
        </div>

    <script>
        // --- 1. CONFIGURACI√ìN DE COLORES (TEMAS) ---
        const temas = {
            morado: {
                principal: '#4a148c', secundario: '#7b1fa2', fondo: '#fbf8fd', 
                aprobadoBg: '#e1bee7', aprobadoBorde: '#6a1b9a', dispBorde: '#d500f9'
            },
            rosado: {
                principal: '#c2185b', secundario: '#e91e63', fondo: '#fff0f6', 
                aprobadoBg: '#f8bbd0', aprobadoBorde: '#ad1457', dispBorde: '#ff4081'
            },
            azul: {
                principal: '#0d47a1', secundario: '#1976d2', fondo: '#e3f2fd', 
                aprobadoBg: '#bbdefb', aprobadoBorde: '#0d47a1', dispBorde: '#2979ff'
            },
            verde: {
                principal: '#1b5e20', secundario: '#388e3c', fondo: '#e8f5e9', 
                aprobadoBg: '#c8e6c9', aprobadoBorde: '#1b5e20', dispBorde: '#00e676'
            }
        };

        function aplicarTema(nombreTema) {
            const t = temas[nombreTema];
            const r = document.documentElement.style;
            r.setProperty('--color-principal', t.principal);
            r.setProperty('--color-secundario', t.secundario);
            r.setProperty('--color-fondo', t.fondo);
            r.setProperty('--estado-aprobado-bg', t.aprobadoBg);
            r.setProperty('--estado-aprobado-borde', t.aprobadoBorde);
            r.setProperty('--estado-disponible-borde', t.dispBorde);
            
            document.getElementById('selector-tema').value = nombreTema;
            localStorage.setItem('malla_tema_preferido', nombreTema);
        }

        // --- 2. BASE DE DATOS: PLAN COM√öN (Semestres 1-6) ---
        const planComun = [
            { id: 'ICO09111', sem: 1, nombre: 'Matem√°ticas I', cr: 6, req: [] },
            { id: 'ICO09112', sem: 1, nombre: 'Programaci√≥n', cr: 6, req: [] },
            { id: 'ICO09113', sem: 1, nombre: 'Fundamentos de admin. y negocios I', cr: 6, req: [] },
            { id: 'ICO09114', sem: 1, nombre: 'Taller de comunicaci√≥n I', cr: 6, req: [] },
            { id: 'CIG1012',  sem: 1, nombre: 'Ingl√©s I', cr: 5, req: [] },
            { id: 'ICO09121', sem: 2, nombre: 'Matem√°ticas II', cr: 6, req: ['ICO09111'] },
            { id: 'ICO09122', sem: 2, nombre: 'Microeconom√≠a I', cr: 6, req: [] },
            { id: 'ICO09123', sem: 2, nombre: 'Contabilidad I', cr: 6, req: [] },
            { id: 'ICO09124', sem: 2, nombre: 'Fundamentos de admin. y negocios II', cr: 6, req: ['ICO09113'] },
            { id: 'CIG1013',  sem: 2, nombre: 'Ingl√©s II', cr: 5, req: ['CIG1012'] },
            { id: 'ICO09211', sem: 3, nombre: 'Matem√°ticas III', cr: 6, req: ['ICO09121'] },
            { id: 'ICO09212', sem: 3, nombre: 'Estad√≠stica I', cr: 6, req: ['ICO09112', 'ICO09121'] },
            { id: 'ICO09213', sem: 3, nombre: 'Macroeconom√≠a I', cr: 6, req: ['ICO09111', 'ICO09122'] },
            { id: 'ICO09214', sem: 3, nombre: 'Tecnolog√≠a y Empresa', cr: 6, req: ['ICO09112'] },
            { id: 'ICO09215', sem: 3, nombre: 'Taller de comunicaci√≥n II', cr: 3, req: ['ICO09114'] },
            { id: 'CIG1014',  sem: 3, nombre: 'Ingl√©s III', cr: 5, req: ['CIG1013'] },
            { id: 'ICO09221', sem: 4, nombre: 'Estad√≠stica II', cr: 6, req: ['ICO09212'] },
            { id: 'ICO09222', sem: 4, nombre: 'Microeconom√≠a II', cr: 6, req: ['ICO09121', 'ICO09122'] },
            { id: 'ICO09223', sem: 4, nombre: 'Contabilidad II', cr: 6, req: ['ICO09123', 'ICO09214'] },
            { id: 'ICO09224', sem: 4, nombre: 'Personas y equipos', cr: 6, req: ['ICO09124'] }, 
            { id: 'ICO09225', sem: 4, nombre: 'Taller de Liderazgo', cr: 3, req: ['ICO09215', 'ICO09124'] },
            { id: 'ICO09226', sem: 4, nombre: 'Ingl√©s IV', cr: 5, req: ['CIG1014'] },
            { id: 'ICO09311', sem: 5, nombre: 'Econometr√≠a I', cr: 6, req: ['ICO09211', 'ICO09221'] },
            { id: 'ICO09312', sem: 5, nombre: 'Macroeconom√≠a II', cr: 6, req: ['ICO09211', 'ICO09213'] },
            { id: 'ICO09313', sem: 5, nombre: 'Finanzas I', cr: 6, req: ['ICO09223', 'ICO09221'] },
            { id: 'ICO09314', sem: 5, nombre: 'Estrategia', cr: 6, req: ['ICO09224', 'ICO09214'] },
            { id: 'ICO09315', sem: 5, nombre: 'Taller de √âtica', cr: 3, req: ['ICO09224', 'ICO09225'] },
            { id: 'ICO09316', sem: 5, nombre: 'Ingl√©s V', cr: 5, req: ['ICO09226'] },
            { id: 'ICO09321', sem: 6, nombre: 'Ciencia de Datos', cr: 6, req: ['ICO09311', 'ICO09214'] },
            { id: 'ICO09322', sem: 6, nombre: 'Globalizaci√≥n y sust.', cr: 6, req: ['ICO09221', 'ICO09312', 'ICO09314'] },
            { id: 'ICO09323', sem: 6, nombre: 'Marketing', cr: 6, req: ['ICO09221', 'ICO09314'] },
            { id: 'ICO09324', sem: 6, nombre: 'Gesti√≥n de operaciones', cr: 6, req: ['ICO09221', 'ICO09314'] },
            { id: 'CFG_1',    sem: 6, nombre: 'CFG I', cr: 5, req: [] },
        ];

        // --- 3. ESPECIALIDADES (Semestres 7-10) ---
        const especialidades = {
            economia: [
                { id: 'ICO09415', sem: 7, nombre: 'Matem√°ticas para Econom√≠a', cr: 6, req: ['ICO09321'] },
                { id: 'ICO09416', sem: 7, nombre: 'Econometr√≠a II', cr: 6, req: ['ICO09321'] },
                { id: 'ICO09417', sem: 7, nombre: 'Teor√≠a de juego', cr: 6, req: ['ICO09222', 'ICO09322'] },
                { id: 'ICO09418', sem: 7, nombre: 'Crecimiento y desarrollo', cr: 6, req: ['ICO09312'] },
                { id: 'CFG_2',    sem: 7, nombre: 'CFG II', cr: 5, req: ['CFG_1'] },
                { id: 'ICO09425', sem: 8, nombre: 'Ciencia de Datos (Eco)', cr: 6, req: ['ICO09416'] },
                { id: 'ICO09426', sem: 8, nombre: 'Econ. de la informaci√≥n', cr: 6, req: ['ICO09417'] },
                { id: 'ICO09427', sem: 8, nombre: 'Pol√≠tica econ√≥mica', cr: 6, req: ['ICO09418'] },
                { id: 'ICO09428', sem: 8, nombre: 'Taller simulaci√≥n eco', cr: 6, req: ['ICO09415', 'ICO09312'] },
                { id: 'CFG_3',    sem: 8, nombre: 'CFG III', cr: 5, req: ['CFG_2'] },
                { id: 'ICO09OPT1', sem: 9, nombre: 'Electivo I', cr: 6, req: [] },
                { id: 'ICO09OPT2', sem: 9, nombre: 'Electivo II', cr: 6, req: [] },
                { id: 'ICO09OPT3', sem: 9, nombre: 'Electivo III', cr: 6, req: [] },
                { id: 'ICO09OPT4', sem: 9, nombre: 'Electivo IV', cr: 6, req: [] },
                { id: 'CFG_4',     sem: 9, nombre: 'CFG IV', cr: 5, req: ['CFG_3'] },
                { id: 'ICO099522', sem: 10, nombre: 'Pr√°ctica profesional', cr: 24, req: ['250CR'] },
                { id: 'ICO09524',  sem: 10, nombre: 'Des. carrera y E-portafolio', cr: 6, req: ['250CR'] },
            ],
            administracion: [
                { id: 'ICO09411', sem: 7, nombre: 'Fund. Econ√≥mico de la Org', cr: 6, req: ['ICO09322', 'ICO09222'] },
                { id: 'ICO09412', sem: 7, nombre: 'Finanzas II', cr: 6, req: ['ICO09313', 'ICO09321'] },
                { id: 'ICO09413', sem: 7, nombre: 'Recursos Humanos', cr: 6, req: ['ICO09224', 'ICO09314'] },
                { id: 'ICO09414', sem: 7, nombre: 'Taller de Emprendimiento', cr: 6, req: ['ICO09323', 'ICO09315'] },
                { id: 'CFG_2',    sem: 7, nombre: 'CFG II', cr: 5, req: ['CFG_1'] },
                { id: 'ICO09421', sem: 8, nombre: 'Ciencia de Datos Negocios', cr: 6, req: ['ICO09321'] },
                { id: 'ICO09422', sem: 8, nombre: 'Implementaci√≥n estrat√©gica', cr: 6, req: ['ICO09412', 'ICO09314', 'ICO09322'] },
                { id: 'ICO09423', sem: 8, nombre: 'Derecho para los Negocios', cr: 6, req: ['ICO09413'] },
                { id: 'ICO09424', sem: 8, nombre: 'Taller de Juego de Negocios', cr: 6, req: ['ICO09414', 'ICO09313'] },
                { id: 'CFG_3',    sem: 8, nombre: 'CFG III', cr: 5, req: ['CFG_2'] },
                { id: 'ICO09OPT_AD1', sem: 9, nombre: 'Optativo Menci√≥n I', cr: 6, req: [] },
                { id: 'ICO09OPT_AD2', sem: 9, nombre: 'Optativo Menci√≥n II', cr: 6, req: [] },
                { id: 'ICO09OPT_AD3', sem: 9, nombre: 'Optativo Menci√≥n III', cr: 6, req: [] },
                { id: 'ICO09OPT_AD4', sem: 9, nombre: 'Optativo Menci√≥n IV', cr: 6, req: [] },
                { id: 'CFG_4',        sem: 9, nombre: 'CFG IV', cr: 5, req: ['CFG_3'] },
                { id: 'ICO09511', sem: 10, nombre: 'Pr√°ctica profesional', cr: 24, req: ['250CR'] },
                { id: 'ICO009524', sem: 10, nombre: 'Des. carrera y E-portafolio', cr: 6, req: ['250CR'] },
            ],
            emprendimiento: [
                { id: 'ICO09410', sem: 7, nombre: 'Emprendimiento y liderazgo en equipos I', cr: 24, req: ['170CR'] }, 
                { id: 'CFG_2',    sem: 7, nombre: 'CFG II', cr: 5, req: ['CFG_1'] }, 
                { id: 'ICO09429', sem: 8, nombre: 'Emprendimiento y liderazgo en equipos II', cr: 24, req: ['ICO09410'] }, 
                { id: 'CFG_3',    sem: 8, nombre: 'CFG III', cr: 5, req: ['CFG_2'] }, 
                { id: 'ICO09511', sem: 9, nombre: 'Emprendimiento y liderazgo en equipos III', cr: 24, req: ['ICO09429'] }, 
                { id: 'CFG_4',    sem: 9, nombre: 'CFG IV', cr: 5, req: ['CFG_3'] }, 
                { id: 'ICO09523', sem: 10, nombre: 'Emprendimiento y liderazgo en equipos IV', cr: 24, req: ['ICO09511'] }, 
                { id: 'ICO09524', sem: 10, nombre: 'Desarrollo de carrera y E-portafolio', cr: 6, req: ['250CR'] }, 
            ]
        };

        // --- L√ìGICA DE LA APLICACI√ìN ---
        
        let aprobados = JSON.parse(localStorage.getItem('malla_comun_aprobados')) || [];
        let mencionActual = 'economia'; 

        // Cargar tema guardado
        const temaGuardado = localStorage.getItem('malla_tema_preferido') || 'morado';
        aplicarTema(temaGuardado);

        function cambiarMencion() {
            mencionActual = document.getElementById('selector-mencion').value;
            renderizar();
        }

        function cambiarTema(nuevoTema) {
            aplicarTema(nuevoTema);
        }

        function getMallaActiva() {
            return [...planComun, ...especialidades[mencionActual]];
        }

        function guardarProgreso() {
            localStorage.setItem('malla_comun_aprobados', JSON.stringify(aprobados));
            renderizar();
        }

        function resetearProgreso() {
            if(confirm("‚ö†Ô∏è ¬øEst√°s segur@ de que quieres borrar todo tu avance y empezar de cero?")) {
                aprobados = [];
                guardarProgreso();
            }
        }

        function getCreditosAprobados() {
            const mallaFull = getMallaActiva();
            return mallaFull.filter(r => aprobados.includes(r.id)).reduce((acc, r) => acc + r.cr, 0);
        }

        function getPorcentajeActual() {
            const mallaActiva = getMallaActiva();
            const misCreditos = getCreditosAprobados();
            const totalCreditos = mallaActiva.reduce((acc, r) => acc + r.cr, 0);
            return Math.round((misCreditos / totalCreditos) * 100);
        }

        function verificarRequisitos(ramo, mallaActiva) {
            if (ramo.req.includes('170CR')) return getCreditosAprobados() >= 170;
            if (ramo.req.includes('250CR')) return getCreditosAprobados() >= 250;
            
            if (ramo.req.length === 0) return true;
            return ramo.req.every(rId => aprobados.includes(rId));
        }

        function traducirRequisitos(reqIds) {
            if (reqIds.includes('250CR')) return "250 Cr√©ditos";
            if (reqIds.includes('170CR')) return "170 Cr√©ditos";
            
            const mallaFull = getMallaActiva();
            return reqIds.map(id => {
                const encontrado = mallaFull.find(r => r.id === id);
                if (!encontrado) {
                    const enComun = planComun.find(r => r.id === id);
                    return enComun ? enComun.nombre : id;
                }
                return encontrado.nombre;
            }).join(', ');
        }

        function toggleRamo(id) {
            // Guardar porcentaje ANTES del cambio
            const porcentajeAntes = getPorcentajeActual();

            const index = aprobados.indexOf(id);
            const mallaActiva = getMallaActiva();
            const ramo = mallaActiva.find(r => r.id === id);

            if (!ramo) return; 

            if (index === -1 && !verificarRequisitos(ramo, mallaActiva)) {
                alert("aun quedan ramos por pasar:( "); 
                return;
            }

            if (index > -1) {
                aprobados.splice(index, 1); // Desmarcar
            } else {
                aprobados.push(id); // Marcar
            }
            
            // Guardar y renderizar para actualizar c√°lculos
            guardarProgreso();

            // Verificar motivaci√≥n DESPU√âS del cambio
            const porcentajeDespues = getPorcentajeActual();
            verificarMensajeMotivacional(porcentajeAntes, porcentajeDespues);
        }

        function verificarMensajeMotivacional(antes, despues) {
            // Solo mostrar mensaje si el porcentaje SUBI√ì (no al desmarcar)
            if (despues <= antes) return;

            if (antes < 25 && despues >= 25) {
                alert("‚ú® ¬°√Ånimo! Lo has hecho muy bien (25%)");
            } else if (antes < 50 && despues >= 50) {
                alert("üî• ¬°Ya queda mucho menos! No te rindas (50%)");
            } else if (antes < 75 && despues >= 75) {
                alert("üöÄ ¬°Todo tu esfuerzo tendr√° resultados! Cada vez queda menos (75%)");
            } else if (antes < 100 && despues >= 100) {
                alert("üéì 100% ¬°Lo lograste, felicidades! A seguir construyendo tu futuro <3");
            }
        }

        function renderizar() {
            const contenedor = document.getElementById('contenedor-malla');
            contenedor.innerHTML = ''; 
            
            const mallaActiva = getMallaActiva();
            const misCreditos = getCreditosAprobados();
            const totalCreditos = mallaActiva.reduce((acc, r) => acc + r.cr, 0);
            const porcentaje = Math.round((misCreditos / totalCreditos) * 100);

            // Actualizar Dashboard
            document.getElementById('texto-progreso').innerText = porcentaje + '%';
            document.getElementById('barra-progreso').style.width = porcentaje + '%';
            document.getElementById('barra-progreso').innerText = porcentaje > 5 ? porcentaje + '%' : '';
            document.getElementById('texto-creditos').innerText = misCreditos;
            document.getElementById('total-creditos-malla').innerText = totalCreditos;
            document.getElementById('conteo-ramos').innerText = aprobados.length;

            // Dibujar Semestres
            for (let i = 1; i <= 10; i++) {
                const col = document.createElement('div');
                col.className = 'semestre-col';
                col.innerHTML = `<div class="semestre-header">Semestre ${i}</div>`;
                
                const ramosSemestre = mallaActiva.filter(r => r.sem === i);
                
                ramosSemestre.forEach(ramo => {
                    const div = document.createElement('div');
                    const aprobado = aprobados.includes(ramo.id);
                    const desbloqueado = verificarRequisitos(ramo, mallaActiva);
                    
                    let estadoClass = 'bloqueado';
                    if (aprobado) estadoClass = 'aprobado';
                    else if (desbloqueado) estadoClass = 'disponible';

                    const reqString = ramo.req.length > 0 ? `Req: ${traducirRequisitos(ramo.req)}` : '';

                    div.className = `card-ramo ${estadoClass}`;
                    div.onclick = () => toggleRamo(ramo.id);
                    div.innerHTML = `
                        <div class="codigo">${ramo.id}</div>
                        <div class="nombre">${ramo.nombre}</div>
                        <div class="req-text">${reqString}</div>
                        <div class="creditos">${ramo.cr} Cr.</div>
                    `;
                    col.appendChild(div);
                });
                contenedor.appendChild(col);
            }
        }

        // Iniciar
        renderizar();
    </script>
</body>
</html>